<button onclick="loadSales('day')">일별</button>
<button onclick="loadSales('week')">주별</button>
<button onclick="loadSales('month')">월별</button>
<canvas id="periodSalesChart"></canvas>
<canvas id="categorySalesChart"></canvas>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    let periodChart, categoryChart;

    function getMonthStartEnd(year, month) {
        const date = new Date(year, month - 1, 1);
        const start = date.toISOString().split('T')[0];
        const end = new Date(year, month, 0).toISOString().split('T')[0];
        return { start, end };
    }

    function loadSales(type) {
        const today = new Date();
        let startDate, endDate;
        if (type === 'day') {
            // 해당 월의 1일~마지막 날
            const year = today.getFullYear();
            const month = today.getMonth() + 1;
            const { start, end } = getMonthStartEnd(year, month);
            startDate = start;
            endDate = end;
        } else if (type === 'week') {
            // 해당 연도의 1월 1일~12월 31일 (또는 10~15주만 보여주고 싶으면 계산)
            const year = today.getFullYear();
            startDate = year + '-01-01';
            endDate = year + '-12-31';
        } else if (type === 'month') {
            // 해당 연도의 1월 1일~12월 31일
            const year = today.getFullYear();
            startDate = year + '-01-01';
            endDate = year + '-12-31';
        }
        fetch(`/admin/sales/dashboard?type=${type}&startDate=${startDate}&endDate=${endDate}`)
            .then(res => res.json())
            .then(data => {
                // 기간별 매출 그래프
                const periodLabels = data.periodSales.map(d => d.label);
                const periodData = data.periodSales.map(d => d.amount);
                if (periodChart) periodChart.destroy();
                periodChart = new Chart(document.getElementById('periodSalesChart'), {
                    type: 'bar',
                    data: {
                        labels: periodLabels,
                        datasets: [{ label: '매출(원)', data: periodData }]
                    }
                });
                // 카테고리별 매출 그래프
                const categoryLabels = data.categorySales.map(d => d.label);
                const categoryData = data.categorySales.map(d => d.amount);
                if (categoryChart) categoryChart.destroy();
                categoryChart = new Chart(document.getElementById('categorySalesChart'), {
                    type: 'bar',
                    data: {
                        labels: categoryLabels,
                        datasets: [{ label: '카테고리별 매출(원)', data: categoryData }]
                    }
                });
            });
    }
    window.onload = function() {
        loadSales('day');
    }
</script>