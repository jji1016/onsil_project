<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>월별 꽃 추천/꽃 리스트/설명/상세</title>
    <style>
        body { font-family: '맑은 고딕', sans-serif; margin: 40px; }
        .month-select { margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; }
        .section-title { font-size: 1.2em; margin-top: 30px; margin-bottom: 10px; color: #2a7; }
        .flower-list, .recommend-list { display: flex; flex-wrap: wrap; gap: 18px; }
        .flower-card {
            border: 1px solid #ddd; border-radius: 8px; padding: 12px; width: 200px; background: #fafafa;
            cursor: pointer; transition: box-shadow .2s;
        }
        .flower-card:hover { box-shadow: 0 2px 8px #bbb; background: #fff; }
        .flower-img { max-width: 160px; max-height: 100px; margin-bottom: 6px; }
        .label { font-weight: bold; color: #2a7; }
        #flower-detail { margin-top: 36px; border: 1px solid #ccc; border-radius: 8px; padding: 20px; max-width: 600px; }
        #searchBar {
            padding: 6px 10px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 200px;
        }
    </style>
</head>
<body>
<h1>월별 꽃 추천 & 이 달의 꽃 리스트</h1>
<div class="month-select">
    <div>
        <label class="label">월 선택: </label>
        <select id="monthSelect" onchange="loadAll()">
            <option value="1">1월</option>
            <option value="2">2월</option>
            <option value="3">3월</option>
            <option value="4">4월</option>
            <option value="5">5월</option>
            <option value="6">6월</option>
            <option value="7">7월</option>
            <option value="8">8월</option>
            <option value="9">9월</option>
            <option value="10">10월</option>
            <option value="11">11월</option>
            <option value="12">12월</option>
        </select>
    </div>
    <input type="text" id="searchBar" placeholder="꽃 이름 검색" oninput="filterFlowerList()" />
</div>

<div class="section-title">이 달의 꽃 추천</div>
<div id="recommend-list" class="recommend-list"></div>

<div class="section-title">이 달의 꽃 리스트</div>
<div id="flower-list" class="flower-list"></div>

<div class="section-title">꽃 상세 설명</div>
<div id="flower-detail"></div>

<script>
    let currentFlowerList = [];

    window.onload = () => {
        const nowMonth = new Date().getMonth() + 1;
        document.getElementById('monthSelect').value = nowMonth;
        loadAll();
    };

    async function loadAll() {
        const month = document.getElementById('monthSelect').value;
        document.getElementById('searchBar').value = '';
        loadRecommendedFlowers(month);
        await loadFlowerList(month);
        document.getElementById('flower-detail').innerHTML = '';
    }

    async function loadRecommendedFlowers(month) {
        const div = document.getElementById('recommend-list');
        div.innerHTML = '불러오는 중...';
        try {
            const res = await fetch(`/api/flowers/month/${month}/recommend`);
            const list = await res.json();
            if (!Array.isArray(list) || list.length === 0) {
                div.innerHTML = "<span style='color:red;'>추천 꽃 정보가 없습니다.</span>";
                return;
            }
            div.innerHTML = '';
            list.forEach(flower => {
                div.innerHTML += `
                    <div class="flower-card" onclick="showDetail(${flower.dataNo || flower.datano})">
                        <img src="${flower.imgUrl1 || flower.imgurl1 || ''}" alt="꽃 이미지" class="flower-img" onerror="this.style.display='none';">
                        <div><span class="label">${flower.flowNm || flower.flownm || ''}</span></div>
                        <div style="font-size:13px; color:#888;">${flower.flowLang || flower.flowlang || ''}</div>
                    </div>
                `;
            });
        } catch (err) {
            div.innerHTML = `<span style='color:red;'>오류: ${err.message}</span>`;
        }
    }

    async function loadFlowerList(month) {
        const div = document.getElementById('flower-list');
        div.innerHTML = '불러오는 중...';
        try {
            const res = await fetch(`/api/flowers/month/${month}/list`);
            const list = await res.json();
            currentFlowerList = list; // 전체 리스트 저장
            if (!Array.isArray(list) || list.length === 0) {
                div.innerHTML = "<span style='color:red;'>꽃 리스트가 없습니다.</span>";
                return;
            }
            renderFlowerList(list);
        } catch (err) {
            div.innerHTML = `<span style='color:red;'>오류: ${err.message}</span>`;
        }
    }

    function renderFlowerList(list) {
        const div = document.getElementById('flower-list');
        div.innerHTML = '';
        list.forEach(flower => {
            div.innerHTML += `
                <div class="flower-card" onclick="showDetail(${flower.dataNo || flower.datano})">
                    <img src="${flower.imgUrl1 || flower.imgurl1 || ''}" alt="꽃 이미지" class="flower-img" onerror="this.style.display='none';">
                    <div><span class="label">${flower.flowNm || flower.flownm || ''}</span></div>
                    <div style="font-size:13px; color:#888;">${flower.flowLang || flower.flowlang || ''}</div>
                    <div style="font-size:12px; color:#555;">${flower.fContent ? flower.fContent.substring(0, 40) + '...' : (flower.fcontent ? flower.fcontent.substring(0, 40) + '...' : '')}</div>
                </div>
            `;
        });
    }

    function filterFlowerList() {
        const query = document.getElementById('searchBar').value.trim().toLowerCase();
        if (!query) {
            renderFlowerList(currentFlowerList);
            return;
        }
        const filtered = currentFlowerList.filter(flower => {
            const name = (flower.flowNm || flower.flownm || '').toLowerCase();
            return name.includes(query);
        });
        renderFlowerList(filtered);
    }

    async function showDetail(dataNo) {
        const detailDiv = document.getElementById('flower-detail');
        detailDiv.innerHTML = '상세정보 불러오는 중...';
        try {
            const res = await fetch(`/api/flowers/${dataNo}`);
            const data = await res.json();
            if (!data || !(data.flowNm || data.flownm)) {
                detailDiv.innerHTML = data.error
                    ? `<span style='color:red;'>${data.error}</span>`
                    : "<span style='color:red;'>꽃 정보를 찾을 수 없습니다.</span>";
                return;
            }
            detailDiv.innerHTML = `
                <h2>${data.flowNm || data.flownm || '-'}</h2>
                <img src="${data.imgUrl1 || data.imgurl1 || ''}" alt="꽃 이미지" style="max-width:200px;" onerror="this.style.display='none';"><br>
                <p><span class="label">학명:</span> ${data.fSctNm || data.fsctNm || '-'}</p>
                <p><span class="label">영문명:</span> ${data.fEngNm || data.fengNm || '-'}</p>
                <p><span class="label">월/일:</span> ${(data.fMonth || data.fmonth || '-') + "월 " + (data.fDay || data.fday || '-') + "일"}</p>
                <p><span class="label">꽃말:</span> ${data.flowLang || data.flowlang || '-'}</p>
                <p><span class="label">설명:</span> ${data.fContent || data.fcontent || '-'}</p>
                <p><span class="label">활용:</span> ${data.fUse || data.fuse || '-'}</p>
                <p><span class="label">생육:</span> ${data.fGrow || data.fgrow || '-'}</p>
                <p><span class="label">유형:</span> ${data.fType || data.ftype || '-'}</p>
                <p><span class="label">출처:</span> ${data.publishOrg || data.publishorg || '-'}</p>
            `;
        } catch (err) {
            detailDiv.innerHTML = `<span style='color:red;'>상세정보 오류: ${err.message}</span>`;
        }
    }
</script>
</body>
</html>
